<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
<title>Python Runner</title>
<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    background: #0d1117;
    color: #e6edf3;
    font-family: system-ui;
}

.header {
    display: flex;
    justify-content: space-between;
    padding: 14px 32px;
    border-bottom: 1px solid #30363d;
}

.btn {
    background: #21262d;
    border: 1px solid #30363d;
    padding: 8px 14px;
    border-radius: 6px;
    color: white;
    cursor: pointer;
}

.btn.run {
    background: #238636;
    border: none;
}

.btn.run:hover {
    background: #2ea043;
}

.main {
    display: grid;
    grid-template-columns:1fr 1fr;
    height: calc(100vh - 60px);
}

.panel {
    padding: 20px;
    overflow: auto;
}

.code, .terminal {
    background: #161b22;
    border-radius: 10px;
    padding: 20px;
    font-family: "JetBrains Mono", monospace;
    white-space: pre;
}

.terminal {
    background: black;
    color: #00ff9c;
}
</style>
</head>

<body>

<div class="header">
    <span id="title"></span>
    <div>
        <button class="btn" onclick="location='index.html'">Back</button>
        <button class="btn run" onclick="run()">▶ Run</button>
    </div>
</div>

<div class="main">
    <div class="panel">
        <div id="code" class="code">Loading…</div>
    </div>
    <div class="panel">
        <div id="output" class="terminal"></div>
    </div>
</div>

<script>
    let pyodide = null;
    let code = "";

    const codeEl = document.getElementById("code");
    const output = document.getElementById("output");
    const title = document.getElementById("title");

    async function load() {
        const file = new URLSearchParams(location.search).get("file");
        title.textContent = file;

        try {
            const r = await fetch(file);
            if (!r.ok) throw "File not found";
            code = await r.text();
            codeEl.textContent = code;
        } catch (e) {
            codeEl.textContent = "ERROR loading file\n" + e;
            return;
        }

        pyodide = await loadPyodide();
}

    async function run() {
        output.textContent = "";
        if (!pyodide) {
            output.textContent = "Python engine not loaded";
            return;
        }

        pyodide.setStdout({batched: s => output.textContent += s});
        pyodide.setStderr({batched: s => output.textContent += s});

        try {
            await pyodide.runPythonAsync(code);
        } catch (e) {
            output.textContent += e;
        }
    }

load();
</script>

</body>
</html>
